{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the ABG Insights application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "medicalProfessionalBackground": {
          "type": "string",
          "description": "The user's medical professional background. This is to ensure the user understands the analysis is not a substitute for professional judgment.",
          "format": "string"
        }
      },
      "required": [
        "id",
        "medicalProfessionalBackground"
      ]
    },
    "AbgAnalysis": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AbgAnalysis",
      "type": "object",
      "description": "Represents a single ABG analysis performed by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ABG analysis."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who performed this analysis. (Relationship: User 1:N AbgAnalysis)"
        },
        "ph": {
          "type": "number",
          "description": "The pH value from the ABG sample.",
          "format": "number"
        },
        "pCO2": {
          "type": "number",
          "description": "The pCO2 value (partial pressure of carbon dioxide) from the ABG sample.",
          "format": "number"
        },
        "hco3": {
          "type": "number",
          "description": "The HCO3 value (bicarbonate) from the ABG sample.",
          "format": "number"
        },
        "paO2": {
          "type": "number",
          "description": "The PaO2 value (partial pressure of oxygen) from the ABG sample.",
          "format": "number"
        },
        "be": {
          "type": "number",
          "description": "The BE value (base excess) from the ABG sample.",
          "format": "number"
        },
        "interpretation": {
          "type": "string",
          "description": "The automated interpretation of the ABG results generated by the application."
        },
        "suggestedConditions": {
          "type": "string",
          "description": "Possible underlying conditions suggested by the application based on the ABG interpretation."
        },
        "treatmentRecommendations": {
          "type": "string",
          "description": "Suggested initial steps or potential treatments recommended by the application."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the analysis was performed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "ph",
        "pCO2",
        "hco3",
        "paO2",
        "be",
        "interpretation",
        "suggestedConditions",
        "treatmentRecommendations",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Access is restricted to the user themselves.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user. Must match the authenticated user's UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/abg_analyses/{abgAnalysisId}",
        "definition": {
          "entityName": "AbgAnalysis",
          "schema": {
            "$ref": "#/backend/entities/AbgAnalysis"
          },
          "description": "Stores ABG analysis data for a specific user. Enforces ownership via path and the 'userId' parameter. Only the user can access their ABG analyses.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who owns this ABG analysis. Must match the authenticated user's UID."
            },
            {
              "name": "abgAnalysisId",
              "description": "The unique identifier for the ABG analysis."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure security, scalability, and ease of debugging, adhering to the core design principles and strategy mandates. It leverages path-based ownership for user-specific data and eliminates the need for `get()` calls in security rules by denormalizing authorization data.\n\nUsers: User data is stored in a dedicated collection (`/users/{userId}`). Access is restricted to the authenticated user (`request.auth.uid == userId`).\n\nAbgAnalysis: Each ABG analysis is stored within a user-specific subcollection (`/users/{userId}/abg_analyses/{abgAnalysisId}`). This structure enforces ownership; only the authenticated user can create, read, update, or delete their own analyses. The `userId` field within the `abg_analyses` collection provides a clear link to the user who owns the data, ensuring authorization independence. Access is controlled by comparing `request.auth.uid` with the `userId` path parameter.\n\nQAPs: The structure facilitates secure `list` operations by isolating user data. Rules can allow listing analyses only where `request.auth.uid == userId`, preventing unauthorized access to other users' data. Segregation of data based on ownership (path-based) also ensures that rules are not used as filters.\n\nInvariants: Ownership is strictly enforced through the path structure. Timestamps, if present, can be validated in rules to ensure data integrity."
  }
}